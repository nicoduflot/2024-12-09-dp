# Formation Drupal

Ce document référence les trucs, typs et recommendation pour configurer serainement un drupal.
Il contient aussi le modèle des données, leurs relations et les particularités des types de contenus.

## Extentions essentielles : 

* A activer dans le coeur
    * Media
    * Media Library
* A télécharger
    * Admin toolbar
    * Token
    * Pathauto
    * Chaos tools

**Format texte et éditeur**
* Remplacer dans HTML simple et HTML Complet l'image par media drupal, 
* cocher la case media intégré, 
* choisir image et vidéo intégré dans la liste de media possibles

## Types de contenu

Sur ce site, voici le "schéma des données" du contenu, indiquant aussi les relations entre les différents types de contenu

### Article
* Créer motif pathauto contenu article
* Taxonomie etiquette
	* Créer motif pathauto sur la taxonomie etiquette
* Retirer le champ image dans le type de contenu article
	* Remplacer par un champ media, limité à 1 et seulement pour les images.
* Créer une taxonomie Catégorie pour les articles.
	* Créer motif pathauto sur la taxonomie Catégories
		* Ajouter les termes de la taxonomie pour automatiser le pathauto.
* Ajouter le champs Catégorie(s) dans le type de contenu article
		
### Page
* Créer motif pathauto contenu page

### Roman
* Champ média limité aux images, une seule image
* Créer le motif pathauto type de contenu Roman
* Une fois que tous les contenus liés sont créés
	* Taxonomie Personnage lie contenu personnage
	* Taxonomie Peuple lie contenu peuple

### Film
* Réutilisation du Champ média limité aux images, une seule image
* Ajout d'un champ média pour trailer et extrait, limité aux vidéo externes* illimité dans la quantité
* Créer le motif pathauto type de contenu Film
* Une fois que tous les contenus liés sont créés
	* Taxonomie Personnage lie contenu personnage
	* Taxonomie Peuple lie contenu peuple

### Personnage
* Champs media intitulé "Portrait" pour y mettre une interprétation graphique d* personnage
* Changement de l'intitulé du body en "Histoire"
* Faire apparaître l'intitulé de "Portrait" et de "Histoire" à l'affichag* visiteur
* Les droits sur le type de contenu
* Créer le motif pathauto type de contenu Personnage
* Une fois que tous les contenus liés sont créés
	* Taxonomie Peuple lie contenu peuple
	* Taxonomie Roman lie contenu roman
	* Taxonomie Film lie contenu film

### Peuple
* Renommer body en "Histoire"
* Ajouter champ media 1 image limitée
* Créer le motif pathauto type de contenu Peuple
* Une fois que tous les contenus liés sont créés
	* Taxonomie personnage lie contenu personnage
	* Taxonomie Roman lie contenu roman
	* Taxonomie Film lie contenu film

## Utilisateurs

#### Création d'un nouveau rôle

On ne peut pas directement créer un rôle depuis un rôle existant, 
il faut créer le rôle et cocher les droit pour chaque partie du site ou de l'admin.

#### Création d'un utilisateur

C'est lors de la création de l'utilisateur qu'on lui assigne un rôle.

En cochant la case "Notifier l'utilisateur de la création de son nouveau compte", ldrupal envoi un email,
dans lequel il y a un lien de connexion unique qui permet à l'utilisateur de modifier son mot de passe, 
de mettre à jours les informations de son compte. Même après la modification du mot de passe, il reste connecté (pas besoin de refaire une connexion avec le nouveau mot de passe).

## Les vues
LEs vues permettent l'affichage de résultat de filtres (ou de requête) sur le contenu.
Une vues peut s'afficher en page, flux XML et en Bloc, intégrable dans la structure du site, les régions.

### Créer une vue
Structure > Vue > ajouter une vue

Il est possible, dès le premier formulaire, de créer la page, le flux XML et le block avec une configuration minimum proche du resultat final voulu.

#### Dans la configuration de page, de flux et de bloc

* La partie titre permet de changer le titre la vue
* La partie format permet de faire la mise en page du resultat du filtre, sous diverses formes (liste non mise en page, grille non responsive, grille responsive, etc). On peut aussi choisir les données a afficher (tout le contenu, certains champs, etc)
    * Si "Champs" est choisi, une partie optionnelle "Champs" permet de sélectionner les champs a afficher et customiser leurs affichages.
* La partie "Critères de filtrage" permet d'ajouter des conditions aux résultats du flitre affiché (contenu, termes de taxonmie associés, etc)
* La partie "Critères de tri" permet de gérer l'ordre du resultat du filtre.
* La partie paramètres de la page permet 
    * spécifié le chemin (nice url) de la page de la vue
    * d'ajouter la vue à un menu en choisissant le titre du lien
    * d'utiliser le thème de l'administration pour l'affichage de la page
* La partie pagination permet de créer, gérer et quantifier le nombre d'éléments par page en cas d'utilisation d'une pagination

En bas de page un aperçu du résultat de vos réglages est visible (avec les vrais informations et liens disponibles sur le site)

## Faire des sauvegarde du site

### Sauvegarde de la configuration

Configuration >  Développement > Synchroniser

* Permet d'exporter une configuration totale ou partielle du site
* Permet d'importe la configuration totale ou partielle du site

## Extention : Backup and Migrate

Une fois l'extension ajoutée et installée

Configuration >  Développement > Backup and Migrate

## Thème Drupal

### Modifications simples du thème

Apparence > Paramètres d'apparence

On ne gère pas énormément de chose sur les thèmes de base de drupal

#### Module CSS Editor

CSS Editor permet d'injecter du CSS en plus du CSS Existant, permettant de surcharger les couleur, polices de caractère, etc du site.

#### Ajouter une police de caractère

Pour ajouter une police de caractère, il suffit d'utiliser @font-face avec les polices compatibles. Il faut ajouter un répertoire fonts (nom écrit par exemple dans le CSS editor) dans le répertoire sites\default\files et que le lien des polices du @font-face soit : 

```css
@font-face {
    font-family: 'VinqueRg';
    src: url('fonts/VinqueRg.eot');
    src: url('fonts/VinqueRg.eot') format('embedded-opentype'),
         url('fonts/VinqueRg.woff2') format('woff2'),
         url('fonts/VinqueRg.woff') format('woff'),
         url('fonts/VinqueRg.ttf') format('truetype'),
         url('fonts/VinqueRg.svg#VinqueRg') format('svg');
}
```

Ensuite, pour appliquer par exemple cette police à tous les titre (et aux classes représentants certains titres)

```css
h1, h2, h3, h4, h5, h6, .site-branding__name, .title page-title{
  font-family: 'VinqueRg', 'Times New Roman', Times, serif;
}
```

Ici, les headings de 1 à 6, le nom du site présent dans l'entête et les titres de pages seront affichés dans la police choisie.

Au finale, le CSS ajouté au total ressemble à ça :

```css
@font-face {
    font-family: 'Roboto';
    font-weight: 100;
    src: url('./fonts/Roboto-Thin.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 100;
    font-style: italic;
    src: url('./fonts/Roboto-ThinItalic.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 300;
    src: url('./fonts/Roboto-Light.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 300;
    font-style: italic;
    src: url('./fonts/Roboto-LightItalic.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 400;
    src: url('./fonts/Roboto-Regular.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 400;
    font-style: italic;
    src: url('./fonts/Roboto-Italic.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 500;
    src: url('./fonts/Roboto-Medium.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 500;
    font-style: italic;
    src: url('./fonts/Roboto-MediumItalic.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 700;
    src: url('./fonts/Roboto-Bold.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 700;
    font-style: italic;
    src: url('./fonts/Roboto-BoldItalic.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 900;
    src: url('./fonts/Roboto-Black.ttf') format('truetype');
}

@font-face {
    font-family: 'Roboto';
    font-weight: 900;
    font-style: italic;
    src: url('./fonts/Roboto-BlackItalic.ttf') format('truetype');
}

:root{
	--font-sans: "Roboto","metropolis", sans-serif;
    --font-serif: "Roboto", "Arial", "verdana", sans-serif;
}

@font-face {
    font-family: 'VinqueRg';
    src: url('fonts/VinqueRg.eot');
    src: url('fonts/VinqueRg.eot') format('embedded-opentype'),
         url('fonts/VinqueRg.woff2') format('woff2'),
         url('fonts/VinqueRg.woff') format('woff'),
         url('fonts/VinqueRg.ttf') format('truetype'),
         url('fonts/VinqueRg.svg#VinqueRg') format('svg');
}

h1, h2, h3, h4, h5, h6, .site-branding__name, .title .page-title{
  font-family: 'VinqueRg', 'Times New Roman', Times, serif;
}

h2.block__title{
  font-size: 1.4rem;
}

aside.region.region--sidebar > .contextual-region.block{
  margin-block-end: 0.5rem;
  margin-block-start: 1rem;
  padding-bottom:  1rem;
  border-bottom: 1px solid var(--color-text-primary-medium);
}

.view{
gap: 1.5rem
}
```

### Création d'un thème enfant

Le principe est de s'appuyer sur un thème stable, qui contient les fichiers twig basics de tous les blocs utilisables sur drupal.

Pour cet exemple, nous partons tu thème préconisé pour créer des thèmes enfants, starterkit_theme, situé dans la partie thèmes du coeur.

Dans la pertie theme de la racine, c'est à dire les thèmes installés hors coeur, il faut tout d'abord créer un répertoire avec le nom du thème enfant.

Il faut ensuite créer les fichiers suivants, qui permettent de rattacher le thème enfant au thème parent

`nomdutheme.info.yml`

l'extension yml désigne souvent un fichier formaté de configuration

```yml
uneClef: 'une donnée'
uneautreClef: 'une autre donnée'
unEnsembleDeDonnees:
    clefSousDonnee: 'donnée'
    autreClefSousDonnee: 'autre donnée'
```

notre fichier s'appellera lotr.info.yml
```yml
# commentaire en yml
# nom du thème, celui qui sera affiché dans l'admin dans la partie apparence, etc.
name: lotr fansite theme
# on indique le type de module
# les thème sont des modules drupal, 
# ils sont simplement placés dans une autre partie physique des fichier pour simplifier 
# la maintenance, l'utilisation, etc
type: theme
# optionnel : la description, c'est à dire la description du thème
description: 'Mon thème enfant base starterkit_theme pour un site sur l'&oelig;uvre de <b>Tolkien</b>'
# La version minimale avec laquelle le thème pourra fonctionner
core_version_requirement: ^9 || ^10 || ^11
# thème parent, on indique LE NOM MACHINE du thème parent, qu'il soit dans le coeur ou dans les thème installés
'base theme': staterkit_theme
# Le logo par défaut du thème
logo: 'images/one-ring-log-01.svg'
# Déclaration des librairies, c'est à dire les fichiers qui serviront pour le style et l'interactivité du site
# on décrira ensuite les librairies dans un fichier nommé
# nomDuSite.libraries.yml
# sur notre thème : lotr.libraries.yml
# lotr est le préfixe dun nom du fichier (lotr), général corresponds à une clef du fichier dans laquelle les informations des librairies seront renseignées
libraries:
    - lotr/general

# déclaration des régions du thème
regions:
    header: 'Header'
    primary_menu: 'Primary menu'
    breadcrumb: 'Breadcrumb'
    secondary_menu: 'Secondary menu'
    highlighted: 'Highlighted'
    custom_region: 'Custom Region'
    help: 'Help'
    content: 'Content'
    sidebar_first: 'Left sidebar'
    sidebar_second: 'Right sidebar'
    footer: 'Footer'
```

Il faut maintenant créer le fichier `lotr.libraries.yml`

```yml
# on est à la clef general, déclarée dans lotr.info.yml à la clef libraries
general:
  # pour simplifier la gestion des librairies css et js, il faut indiquer que ces fichiers seront chargés dans l'entête du document
  header: true
  # indiquer les ressource css
  css:
    #indiquer ensuite ces fichiers sont dans le theme
    theme:
      css/bootstrap.css: {media: screen}
      css/style.css: {media: screen}
      css/print.css: {media: print}
  # indiquer les ressources JS
  js:
    theme:
      js/bootstrap.bundle.js: {}
      js/scripts.js: {}
```

et enfin il faut créer le fichier qui permet de customiser la partie apparence dans l'admin, même si on ne customise rien, il est préférable de le créer
`nomDuTheme.theme`

le fichier `lotr.theme`

```php
<?php
/**
 * @file
 * lotr theme file
 */
```